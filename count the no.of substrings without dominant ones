class Solution:
    def numberOfSubstrings(self, s: str) -> int:
        n = len(s)
        ans = 0
        maxZero = int(( -1 + math.isqrt(1 + 4 * n) ) // 2)
        for z in range(maxZero + 1):
            last_invalid = -1
            count0 = 0
            count1 = 0
            l = 0
            for r, ch in enumerate(s):
                if ch == '0':
                    count0 += 1
                else:
                    count1 += 1
                while l < r:
                    if s[l] == '0' and count0 > z:
                        count0 -= 1
                        last_invalid = l
                        l += 1
                    elif s[l] == '1' and count1 - 1 >= z * z:
                        count1 -= 1
                        l += 1
                    else:
                        break
                if count0 == z and count1 >= z * z:
                    ans += (l - last_invalid)
        return ans
